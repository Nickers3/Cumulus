<aura:component implements="force:hasRecordId,flexipage:availableForAllPageTypes"
                controller="batchPOC_CTRL"
                access="global">

    <!--Public Attributes-->
    <aura:attribute name="data" type="Object"/>
    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="labels" type="Map"/>
    <aura:attribute name="rowId" type="String"/>
    <aura:attribute name="showDetails" type="Boolean" default="false"/>
    <aura:attribute name="recordId" type="Id"/>
    <aura:attribute name="hasActiveRow" type="Boolean" default="false"/>
    <aura:attribute name="formFields" type="Object[]" default="[]"/>
    <aura:attribute name="donorType" type="String" default="Contact1"/>

    <!--Events-->
    <aura:handler name="init" action="{!c.doInit}" value="{!this}"/>

    <!--Start Markup-->
    <lightning:overlayLibrary aura:id="overlayLib"/>

    <lightning:layout multipleRows="true">

        <!--Expected totals-->
        <!--<lightning:layoutItem size="12" padding="around-small">
            <lightning:card>
                <div class="slds-grid slds-p-horizontal_medium">
                    EXPECTED TOTALS MATCH STUFF HERE!
                </div>
            </lightning:card>
        </lightning:layoutItem>-->

        <!--Start New Row-->
        <lightning:layoutItem size="12" padding="around-small">
            <lightning:card title="New Gift">

                <aura:if isTrue="{!v.hasActiveRow}">
                    <lightning:recordEditForm aura:id="recordEditForm"
                                              objectApiName="{!v.labels.dataImportObject}"
                                              onsuccess="{!c.onSuccess}">

                        <div class="slds-grid">
                            <!-- Donor fields -->
                            <div class="slds-col slds-p-horizontal_small">
                                <label for="donorType">Donor Type</label>
                                <lightning:select aura:id="donorType" label="Donor Type" value="{!v.donorType}" onchange="{!c.setDonorType}">
                                    <option value="Contact1">Contact</option>
                                    <option value="Account1">Account</option>
                                </lightning:select>
                            </div>

                            <!-- using a hidden field to bind the pretty lightning:select above with the actual Data Import field -->
                            <div class="slds-hide">
                                <lightning:inputField fieldName="{!v.labels.donationDonor}" value="{!v.donorType}"/>
                            </div>

                            <div class="slds-col slds-p-horizontal_small">
                                <aura:if isTrue="{!v.donorType == 'Contact1'}">
                                    <label for="ContactLookup">Contact</label>
                                    <lightning:inputField aura:id="ContactLookup" fieldName="{!v.labels.contactLookup}"
                                                          variant="label-hidden"
                                                          class="editField"
                                    />
                                </aura:if>
                                <aura:if isTrue="{!v.donorType == 'Account1'}">
                                    <label for="AccountLookup">Account</label>
                                    <lightning:inputField aura:id="AccountLookup" fieldName="{!v.labels.accountLookup}"
                                                          variant="label-hidden"
                                                          class="editField"
                                    />
                                </aura:if>
                            </div>
                            <!--Field iteration -->
                            <aura:iteration items="{!v.formFields}" var="field" indexVar="index">
                                <div class="slds-col slds-p-horizontal_small">
                                    <label for="{!field.name}">{!field.label}</label>
                                    <lightning:inputField aura:id="{!field.name}" fieldName="{!field.name}"
                                                          variant="label-hidden"
                                                          class="editField"
                                    />
                                </div>
                            </aura:iteration>
                        </div>

                        <!--Form buttons-->
                        <div class="slds-grid slds-p-around_medium slds-grid_align-center slds-size_1-of-1">
                            <div class="slds-col slds-p-horizontal_small">
                                <lightning:button label="Cancel" onclick="{!c.clearRow}" variant="neutral"/>
                                <lightning:button variant="brand" type="submit" name="save" label="Save" />
                            </div>
                        </div>

                    </lightning:recordEditForm>
                </aura:if>

            </lightning:card>
        </lightning:layoutItem>

        <!--End New Row-->

        <!--Start BGE Grid-->
        <lightning:layoutItem size="12" padding="around-small">
            <lightning:card title="All Gifts">
                <lightning:datatable
                        columns="{! v.columns }"
                        data="{! v.data }"
                        keyField="id"
                        onsave="{!c.onSave}"
                        minColumnWidth="150"
                        hideCheckboxColumn="true"
                        onrowaction="{! c.handleRowAction }"/>
            </lightning:card>
        </lightning:layoutItem>
        <!--End BGE Grid-->

    </lightning:layout>
    <!--End Markup-->
</aura:component>